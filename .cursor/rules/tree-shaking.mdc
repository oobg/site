---
description: 트리쉐이킹 및 번들 최적화 전략. 라우트 스플리팅, 임포트 규칙, 동적 로드.
---

# 트리쉐이킹·번들 전략

이 문서는 초기 번들 크기 절감과 트리쉐이킹 효과를 유지하기 위한 규칙을 정리한다.

## 1. 라우트 단위 코드 스플리팅

- **페이지 lazy는 내보내는 쪽에서 정의**  
  각 페이지 슬라이스(`src/pages/<name>/index.tsx`)에서 `React.lazy(() => import("./ui/Page").then(m => ({ default: m.XXXPage })))` 형태로 **Lazy 컴포넌트만** export한다.  
  동일 파일에서 해당 페이지를 정적 re-export하면 동적 청크가 분리되지 않으므로, 라우터에서 쓸 Lazy만 export한다.

- **라우터는 `@/pages`에서만 페이지를 불러온다**  
  `src/app/router.tsx`에서는 `@/pages` 배럴만 import하고, 배럴(`src/pages/index.ts`)은 각 페이지의 `*Lazy`만 re-export한다.  
  이렇게 하면 라우트별 청크가 분리되고, prism/diff/culori/sql-formatter 등 무거운 의존성은 해당 페이지 진입 시에만 로드된다.

- **Suspense**  
  `RootLayout`에서 `<Outlet />`을 `<Suspense fallback={null}>`로 감싼다.

## 2. Vite 청크 분리

- `vite.config.ts`의 `build.rollupOptions.output.manualChunks`에서:
  - **react-vendor**: `react`, `react-dom`, `react-router-dom`
  - **motion**: `framer-motion`
- 청크는 2~3개 수준으로 유지해 요청 수를 늘리지 않는다.

## 3. 임포트 규칙

- **lucide-react**  
  항상 **named import** (`import { Copy } from "lucide-react"`).  
  `import * as Icons` 금지.

- **feature barrel**  
  feature는 필요한 타입·컴포넌트만 export한다.  
  무거운 라이브러리(prism, diff, culori, sql-formatter)는 feature 내부에서만 import하고 barrel에서 재export하지 않는다.

- **shared**  
  `@/shared/**` 4세그먼트 제한 유지.  
  무거운 유틸은 사용하는 페이지/feature에서만 import해 해당 라우트 청크에만 포함되게 한다.

- **서드파티 추가 시**  
  가능한 한 ESM + named/specific export를 지원하는 패키지를 선택한다.

## 4. Prism 언어 동적 로드

- code-formatter feature에서 Prism 언어 컴포넌트는 **선택된 언어에 맞춰 동적 import**한다.  
  `prismjs/components/prism-css`, `prism-javascript` 등은 정적 상단 import 대신, 해당 언어가 필요할 때 `import("prismjs/components/prism-sql")` 등으로 한 번만 로드한다.  
  code-formatter 청크의 초기 파싱 비용을 줄인다.

## 5. MSW 동적 로드

- MSW는 **프로덕션 번들에 포함되지 않도록** 사용한다.  
  활성화 조건: `import.meta.env.DEV && import.meta.env.VITE_MSW === "true"`.  
  앱 부트 시 이 조건이 참일 때만 `import("@/msw")` 등으로 **동적 import**해 초기화한다.  
  상세는 `src/main.tsx` 및 MSW 설정 문서를 참고한다.
